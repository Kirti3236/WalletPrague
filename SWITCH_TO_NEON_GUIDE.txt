================================================================================
  SWITCH TO NEON DATABASE - RECOMMENDED SOLUTION
  Fix IPv6/DNS Issues with Supabase
================================================================================

PROBLEM:
- Supabase DNS resolution failing from Render (ENOTFOUND)
- IPv6 connection issues
- Network incompatibility between Render and Supabase

SOLUTION:
âœ… Switch to Neon database (better IPv4 support, works with Render)

WHY NEON:
- âœ… Better IPv4 support (resolves to IPv4 by default)
- âœ… 3GB free (vs Supabase's 500MB)
- âœ… Works reliably with Render
- âœ… Free forever (no expiration)
- âœ… Same PostgreSQL, easy migration

================================================================================
STEP 1: CREATE NEON ACCOUNT (5 minutes)
================================================================================

1. Go to: https://neon.tech
2. Click "Sign Up" or "Get Started"
3. Sign up with:
   - GitHub (recommended)
   - OR Email address
4. Verify email if required
5. Complete signup

================================================================================
STEP 2: CREATE NEON PROJECT (3 minutes)
================================================================================

1. After signup, click "Create a project"
2. Fill in:
   - Project Name: yapague-db (or any name)
   - Region: Choose closest to your location
     * Options: US East, US West, EU, etc.
   - PostgreSQL Version: 15 or 16 (both work)
3. Click "Create Project"
4. Wait 1-2 minutes for provisioning

================================================================================
STEP 3: GET NEON CONNECTION DETAILS (2 minutes)
================================================================================

1. Once project is ready, you'll see the Dashboard
2. Look for "Connection string" or "Connection details"
3. You'll see something like:
   ```
   postgresql://username:password@ep-xyz-123.us-east-2.aws.neon.tech/neondb
   ```

4. Extract the values:
   - Host: ep-xyz-123.us-east-2.aws.neon.tech
     (The part after @ and before :5432 or /)
   - Port: 5432 (usually)
   - Database: neondb (or your database name)
   - Username: (from connection string)
   - Password: (shown when you created project - SAVE THIS!)

OR

5. In Neon Dashboard, go to "Connection Details"
6. You'll see separate fields:
   - Host
   - Port
   - Database
   - User
   - Password (click "Show" to reveal)

================================================================================
STEP 4: UPDATE RENDER ENVIRONMENT VARIABLES (5 minutes)
================================================================================

Go to Render Dashboard â†’ Your Service â†’ Environment Variables

UPDATE THESE VALUES:

DB_HOST = [Neon Host]
   Example: ep-xyz-123.us-east-2.aws.neon.tech
   (Just hostname, no https:// or port)

DB_PORT = 5432
   (Usually 5432 for Neon)

DB_USERNAME = [Neon Username]
   (From connection string, usually not "postgres")

DB_PASSWORD = [Neon Password]
   (The password you created or was generated)

DB_NAME = [Neon Database Name]
   (Usually "neondb" or your project name)

KEEP ALL OTHER VARIABLES THE SAME:
- All JWT secrets (same)
- Cloudinary (same)
- Email (same)
- Everything else (same)

ONLY CHANGE: DB_HOST, DB_PORT, DB_USERNAME, DB_PASSWORD, DB_NAME

================================================================================
STEP 5: TEST CONNECTION (2 minutes)
================================================================================

1. Save environment variables in Render
2. Service will restart automatically
3. Check logs for:
   âœ… "Database connection established"
   âœ… "Application is running"
   âœ… No more IPv6 or DNS errors

================================================================================
STEP 6: MIGRATE DATA (If Needed)
================================================================================

If you have existing data in Supabase:

OPTION A: Start Fresh (Recommended for dev/testing)
- Neon database will be empty
- Your code will create tables automatically (DB_SYNC=true)
- You can seed data if needed

OPTION B: Export/Import (If you need existing data)
1. Export data from Supabase (pg_dump)
2. Import to Neon (psql or Neon dashboard)
3. This is more complex - only if you have important data

For development/testing, starting fresh is usually fine.

================================================================================
NEON CONNECTION STRING FORMAT
================================================================================

Neon connection strings look like:
postgresql://username:password@ep-xyz-123.region.aws.neon.tech/neondb

Extract:
- Host: ep-xyz-123.region.aws.neon.tech
- Port: 5432 (default, not in connection string)
- Database: neondb (after the last /)
- Username: (before the : in connection string)
- Password: (between : and @)

================================================================================
QUICK CHECKLIST
================================================================================

[ ] Created Neon account
[ ] Created Neon project
[ ] Got connection details
[ ] Updated DB_HOST in Render
[ ] Updated DB_PORT in Render (5432)
[ ] Updated DB_USERNAME in Render
[ ] Updated DB_PASSWORD in Render
[ ] Updated DB_NAME in Render
[ ] Saved all changes
[ ] Service restarted
[ ] Checked logs - connection successful

================================================================================
WHY THIS WILL WORK
================================================================================

âœ… Neon resolves to IPv4 by default
âœ… Better network compatibility with Render
âœ… No DNS resolution issues
âœ… Same PostgreSQL - your code works as-is
âœ… Free tier is generous (3GB)

================================================================================
TROUBLESHOOTING
================================================================================

If connection still fails:
1. Verify all credentials are correct
2. Check Neon project is "Active"
3. Verify SSL is enabled (NODE_ENV=production)
4. Check logs for specific error messages

If you see SSL errors:
- Make sure NODE_ENV=production in Render
- SSL is automatically enabled for external databases

================================================================================
COMPARISON: SUPABASE vs NEON
================================================================================

SUPABASE:
- 500MB free
- IPv6 resolution issues with Render
- DNS resolution problems
- Connection pooler needed

NEON:
- 3GB free (6x more!)
- IPv4 by default
- Better Render compatibility
- Direct connection works
- Free forever

================================================================================
ESTIMATED TIME
================================================================================

Total time to switch: 15-20 minutes
- Create account: 2 min
- Create project: 3 min
- Get credentials: 2 min
- Update Render: 5 min
- Test: 3 min
- Verify: 2 min

================================================================================
NEXT STEPS AFTER SWITCHING
================================================================================

1. âœ… Database connected successfully
2. âœ… Tables created automatically (DB_SYNC=true)
3. âœ… API is working
4. âœ… Test all endpoints
5. âœ… Set up UptimeRobot monitoring
6. âœ… Deployment complete!

================================================================================
END OF NEON SWITCH GUIDE
================================================================================

Neon is the recommended solution for Render deployments.
It will solve your IPv6/DNS issues immediately!

Good luck! ðŸš€

================================================================================

